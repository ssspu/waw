# 后端修改文档

## 一、品牌列表接口 (已完成映射逻辑)

### 需求说明

前端 `store-type` 字段需要根据店铺的经营类型显示为以下四个分类之一：
- **专业店**
- **品牌店**
- **工作室**
- **综合店**

### 当前状态

前端已添加映射逻辑，将 `business_mode` 映射到对应的类型名称：

| business_mode 值 | 对应显示类型 |
|------------------|-------------|
| 单店经营 | 专业店 |
| 连锁经营 | 品牌店 |
| 品牌直营 | 品牌店 |
| 工作室 | 工作室 |
| 商场店 | 综合店 |
| 街边店 | 综合店 |
| 写字楼店 | 综合店 |
| 创意园 | 综合店 |

### 字段说明

| 字段名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| business_mode | string | 是 | 经营模式，可选值：`单店经营`、`连锁经营`、`品牌直营`、`工作室`、`商场店`、`街边店`、`写字楼店`、`创意园` |

---

## 二、服务列表接口 (已完成距离计算)

### 需求说明

前端服务列表需要展示服务距离，需要后端返回服务的经纬度坐标。

### 当前状态

前端 `ServiceGallerySection.vue` 组件已实现距离计算逻辑，会根据用户当前位置与服务经纬度计算距离并展示。

### 后端需要返回的字段

| 字段名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| longitude | number | 是 | 服务位置经度 |
| latitude | number | 是 | 服务位置纬度 |
| location_desc | string | 否 | 位置描述文字，如"上海市黄浦区xxx路" |

### 接口响应示例

**服务列表接口**: `GET /service/list`

```json
{
  "code": 200,
  "data": {
    "items": [
      {
        "id": "xxx",
        "name": "精剪洗吹",
        "image_urls": ["https://xxx.com/image1.jpg"],
        "fixed_ref_price": 88,
        "fixed_price": 68,
        "detail_text": "专业精剪+洗吹造型",
        "designerName": "李师傅",
        "designerAvatar": "https://xxx.com/avatar.jpg",
        "rating": 4.9,
        "review_count": 128,
        "longitude": 121.4737,
        "latitude": 31.2304,
        "location_desc": "上海市黄浦区xxx路"
      }
    ]
  }
}
```

### 前端距离计算逻辑

前端使用 Haversine 公式计算两点之间的距离：

```javascript
// utils/location.js
function calculateDistance(lat1, lon1, lat2, lon2) {
  const R = 6371 // 地球半径(km)
  const dLat = deg2rad(lat2 - lat1)
  const dLon = deg2rad(lon2 - lon1)
  const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
            Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) *
            Math.sin(dLon/2) * Math.sin(dLon/2)
  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a))
  const distance = R * c
  return distance < 1
    ? `${Math.round(distance * 1000)}m`
    : `${distance.toFixed(1)}km`
}
```

---

## 三、建议

如果后端字段存储的值不在上述映射表中，前端会使用默认值。为确保用户体验，建议后端统一字段值：

- **品牌类型**: 使用 `单店经营`、`连锁经营`、`品牌直营`、`工作室`、`商场店`、`街边店`、`写字楼店`、`创意园`
